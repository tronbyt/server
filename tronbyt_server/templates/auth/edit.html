{% extends 'base.html' %}
{% block header %}
<h1>{% block title %}{{ _('Edit Settings') }}{% endblock %}</h1>
{% endblock %}
{% block content %}
{% if g.user['username'] == "admin" %}
<form method="post" action="{{ url_for('manager.set_system_repo') }}">
    <label for="app_repo_url">{{ _('System App Repo URL (Public Github Only!)') }}</label>
    <input name="app_repo_url" id="app_repo_url" required value="{{ user['system_repo_url'] }}">
    {{ _('Replacing the existing system repo will delete the previous repo and break any apps using that repo.') }}
    <input type="submit" value="{{ _('Save') }}" class="w3-button w3-green"></input>
</form>
<form method="post" action="{{ url_for('manager.refresh_system_repo') }}">
    <input type="submit" value="{{ _('Refresh') }}" class="w3-button w3-green"></input>
</form>
{% endif %}
<form method="post" action="{{ url_for('manager.set_user_repo') }}" >
    <label for="app_repo_url">{{ _('Custom App Repo URL (Public Github Only!)') }}</label>
    <input name="app_repo_url" id="app_repo_url" required value="{{ user['app_repo_url'] }}">
    {{ _('Replacing an existing custom repo will delete the previous repo and break any apps using that repo.') }}

    <input type="submit" value="{{ _('Save') }}" class="w3-button w3-green"></input>
</form>
<form method="post" action="{{ url_for('manager.refresh_user_repo') }}">
    <input type="submit" value="{{ _('Refresh') }}" class="w3-button w3-green"></input>
</form>

<h1>{{ _('Edit Password') }}</h1>
<form method="post">
    <label for="old_password">{{ _('Old Password') }}</label>
    <input type="password" name="old_password" id="old_password" required>
    <label for="password">{{ _('New Password') }}</label>
    <input type="password" name="password" id="password" required>
    <input type="submit" value="{{ _('Save') }}" class="w3-button w3-green"></input>
</form>

<h1>{{ _('Edit API Key') }}</h1>
<form method="post" action="{{ url_for('manager.set_api_key') }}">
    <label for="api_key">{{ _('API Key') }}</label>
    <input type="text" name="api_key" id="api_key" required value="{{ user.get('api_key', '') }}">
    <input type="submit" value="{{ _('Save') }}" class="w3-button w3-green"></input>
</form>

<p>{{ _('Use the export and import features to backup your user account or to move your devices to a new server. The export function creates a JSON file with all your settings, devices, and apps. You can then import this file on another server to restore your configuration. Note that your password is not included in the export for security reasons, so you will need to remember your password when importing to a new server.') }}</p>

<h1>{{ _('Export User Data') }}</h1>
<p>{{ _('Export your entire user configuration as a JSON file.') }}</p>
<a href="{{ url_for('manager.export_user_config') }}" class="w3-button w3-blue">{{ _('Export User Data') }}</a>

<h1>{{ _('Import User Data') }}</h1>
<p>{{ _('Import your user configuration from a JSON file. This will replace your current configuration, but preserve your username and password.') }}</p>
<form method="post" action="{{ url_for('manager.import_user_config') }}" enctype="multipart/form-data">
    <input type="file" name="file" accept=".json" required>
    <input type="submit" value="{{ _('Import User Data') }}" class="w3-button w3-blue">
</form>

{% endblock %}
