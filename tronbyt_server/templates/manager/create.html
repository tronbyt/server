{% extends 'base.html' %}
{% block header %}
<script src="{{ url_for('static', filename='js/location.js') }}"></script>
<h1>{% block title %}{{ _('New Tronbyt Device') }}{% endblock %}</h1>
<script>
  function setBrightnessCreate(brightness) {
    document.getElementById('brightness').value = brightness;
    document.getElementById('brightness-output').innerText = brightness;
    const buttons = document.querySelectorAll('#brightness-panel .brightness-btn');
    buttons.forEach(btn => {
      if (parseInt(btn.dataset.brightness) === parseInt(brightness)) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
  }
</script>
{% endblock %}
{% block content %}
<form method="post">
  <span><label for="name">{{ _('Name') }}</label> ({{ _('Descriptive name for this Tronbyt device') }})</span>
  <input name="name" id="name" value="{{ request.form['name'] }}" required>
  <span><label for="device_type">{{ _('Device Type') }}</label></span>
  <select name="device_type" id="device_type">
    <option value="tidbyt_gen1" selected>Tidbyt Gen1</option>
    <option value="tidbyt_gen2">Tidbyt Gen2</option>
    <option value="pixoticker">Pixoticker</option>
    <option value="tronbyt_s3">Tronbyt S3</option>
    <option value="tronbyt_s3_wide">Tronbyt S3 Wide</option>
    <option value="raspberrypi">Raspberry Pi</option>
    <option value="other">Other</option>
  </select>
  <span><label for="img_url">{{ _('Image URL') }}</label> ({{ _('Leave blank unless advanced user.') }})</span>
  <input name="img_url" id="img_url" value="{{ request.form['img_url'] }}">
  <span><label for="ws_url">{{ _('WebSocket URL') }}</label> ({{ _('Leave blank unless advanced user.') }})</span>
  <input name="ws_url" id="ws_url" value="{{ request.form['ws_url'] }}">
  <span><label>{{ _('Brightness Level ( 0 - 5 )') }}</label></span>
  <output id="brightness-output">3</output>
  <input type="hidden" name="brightness" id="brightness" value="3">
  <div class="brightness-panel" id="brightness-panel">
    <button type="button" class="brightness-btn" data-brightness="0" onclick="setBrightnessCreate(0)">0</button>
    <button type="button" class="brightness-btn" data-brightness="1" onclick="setBrightnessCreate(1)">1</button>
    <button type="button" class="brightness-btn" data-brightness="2" onclick="setBrightnessCreate(2)">2</button>
    <button type="button" class="brightness-btn active" data-brightness="3" onclick="setBrightnessCreate(3)">3</button>
    <button type="button" class="brightness-btn" data-brightness="4" onclick="setBrightnessCreate(4)">4</button>
    <button type="button" class="brightness-btn" data-brightness="5" onclick="setBrightnessCreate(5)">5</button>
  </div>

  <!-- <span><label for="api_key">Device API KEY</label> (leave blank)</span> -->
  <!-- <textarea name="api_key" id="api_key" rows="5"></textarea>  -->
  <input type="hidden" name="api_key" id="api_key">
  <label for="notes">{{ _('Notes') }}</label>
  <input name="notes" id="notes" value="{{ request.form['notes'] }}">
  <div>
    <label for="location_search">{{ _('Location') }}</label>
    <input type="text" id="location_search" style="width: 100%" placeholder="{{ _('Enter a location') }}"
      value="{{ request.form['location_search'] }}">
    <ul id="location_results"></ul>
  </div>
  <input type="hidden" name="location" id="location" value='{{ (request.form["location"] or {}) | tojson }}'>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      enableLocationSearch(document.getElementById('location_search'), document.getElementById('location_results'), document.getElementById('location'), null);
    });
  </script>
  <input type="submit" class="w3-button w3-green" value="{{ _('Save') }}">
</form>
<a href="{{ url_for('manager.import_device') }}" class="w3-button w3-orange">
  {{ _('Import Configuration') }}
</a>
{% endblock %}