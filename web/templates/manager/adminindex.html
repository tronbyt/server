{{ define "adminindex" }}
{{ template "base" . }}
{{ end }}
{{ define "title" }}{{ t .Localizer "Tronbyt Manager" }}{{ end }}
{{ define "header" }}
<!-- Add viewport meta tag -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Include external CSS and JS -->
<link rel="stylesheet" href="/static/css/manager.css">
{{ end }}
{{ define "content" }}
{{ if .User }}
<br>
<a class="w3-button w3-purple w3-round w3-padding"
   href="/devices/create"><i class="fa-solid fa-circle-plus" aria-hidden="true"></i> {{ t .Localizer "New Tronbyt" }}</a>
<hr>
{{ end }}
{{ range .Users }}
<div class="w3-container w3-blue-grey w3-padding w3-round user-header">
    <h2 class="user-header-title">{{ .Username }}</h2>
    {{ if ne .Username $.User.Username }}
    <button class="w3-button w3-red w3-round"
            onclick="deleteUser('{{ .Username }}')">
        <i class="fa-solid fa-trash"></i> {{ t $.Localizer "Delete User" }}
    </button>
    {{ end }}
</div>
{{ if .Devices }}
{{ $userDevices := .Devices }}
{{ range .Devices }}
{{ template "device_card" (dict "Item" . "Localizer" $.Localizer "Devices" $userDevices "ReadOnly" true) }}
<hr>
{{ end }}
{{ else }}
<p class="no-devices-message">{{ t $.Localizer "No devices found for this user." }}</p>
<hr>
{{ end }}
{{ end }}
<script>
    function deleteUser(username) {
        if (!confirm('{{ t .Localizer "Delete User?" }}')) return;

        fetch('/admin/users/' + username, {
            method: 'DELETE'
        }).then(response => {
            if (response.ok || response.redirected) {
                window.location.reload();
            } else {
                alert('{{ t .Localizer "Failed to delete user" }}');
            }
        }).catch(err => {
            console.error(err);
            alert('{{ t .Localizer "Error deleting user" }}');
        });
    }
</script>
{{ end }}
