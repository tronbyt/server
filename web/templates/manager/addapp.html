{{ define "addapp" }}
{{ template "base" . }}
{{ end }}

{{ define "title" }}{{ t .Localizer "Add App" }}{{ end }}

{{ define "header" }}
<link rel="stylesheet" href="/static/css/addapp-simple.css">
<h1>{{ t .Localizer "Add App" }}</h1>
{{ end }}

{{ define "content" }}
<div id="addapp_page_identifier">
<!-- Loading indicator -->
<div id="loading-indicator" class="loading-container">
  <div class="loading-spinner"></div>
  <p>{{ t .Localizer "Loading apps..." }}</p>
</div>

<a class="w3-button w3-purple w3-round w3-padding" href="/devices/{{ .Device.ID }}/uploadapp"><i class="fa-solid fa-cloud-arrow-up" aria-hidden="true"></i> {{ t .Localizer "Upload app" }}</a>

<form method="post" id="main_form">
  <label for="name">{{ t .Localizer "App Selection" }}</label>

  {{ if .CustomApps }}
    {{ template "app_list_grid" (dict
        "Title" (t .Localizer "Custom Apps")
        "SearchID" "custom_search"
        "GridID" "custom_app_grid"
        "Apps" .CustomApps
        "IsCustom" true
        "DeviceID" .Device.ID
        "Localizer" .Localizer
        "ConfigProduction" .Config.Production
    ) }}
    <hr>
  {{ end }}

  {{ template "app_list_grid" (dict
      "Title" (t .Localizer "System Apps")
      "SearchID" "system_search"
      "GridID" "system_app_grid"
      "Apps" .SystemApps
      "ShowControls" true
      "IsCustom" false
      "DeviceID" .Device.ID
      "Localizer" .Localizer
      "SystemRepoInfo" .SystemRepoInfo
      "ConfigProduction" .Config.Production
  ) }}

  <input type="hidden" name="name" id="selected_app">
  <input type="hidden" name="path" id="selected_app_path">
  <br>
  <label for="uinterval">{{ t .Localizer "Render Interval (minutes)" }}</label>
  <input name="uinterval" type="number" id="uinterval" min="0" value="10" required>
  <label for="display_time">{{ t .Localizer "Display Time (seconds)" }}</label>
  <input name="display_time" type="number" id="display_time" min="0" value="0" required>

  <label for="notes">{{ t .Localizer "Notes" }}</label>
  <textarea name="notes" id="notes"></textarea>

  <button type="submit" class="w3-button w3-green"><i class="fa-solid fa-sliders" aria-hidden="true"></i> {{ t .Localizer "Configure" }}</button>
</form>
</div>
{{ end }}

{{ define "app_list_grid" }}
<div class="app-group">
    <h3>{{ .Title }}</h3>

    {{ if .ShowControls }}
    <div class="filter-sort-controls">
        <div class="filter-sort-controls-inner">
            <input type="search" id="{{ .SearchID }}" placeholder="{{ t .Localizer "Search apps" }}"
                onkeyup="searchApps('{{ .SearchID }}')" oninput="searchApps('{{ .SearchID }}')" />

            <label class="control-label">
                <input type="checkbox" id="hide_installed_{{ .SearchID }}" onchange="toggleInstalledApps('{{ .SearchID }}')" class="control-checkbox">
                {{ t .Localizer "Hide installed apps" }}
            </label>

            <label for="sort_{{ .SearchID }}" class="control-label">
                {{ t .Localizer "Sort by:" }}
                <select id="sort_{{ .SearchID }}" onchange="sortApps('{{ .SearchID }}')">
                    <option value="system" selected>{{ t .Localizer "Default" }}</option>
                    <option value="alphabetical">{{ t .Localizer "Alphabetical (A-Z)" }}</option>
                    <option value="rev-alphabetical">{{ t .Localizer "Alphabetical (Z-A)" }}</option>
                </select>
            </label>
        </div>
    </div>
    {{ end }}

    <div id="{{ .GridID }}" class="app-grid">
        {{ range .Apps }}
        <div class="app-item" data-value="{{ .ID }}" data-path="{{ .Path }}" data-name="{{ .Name }}" data-installed="{{ .IsInstalled }}" data-recommended-interval="{{ .RecommendedInterval }}">
            {{ if .IsInstalled }}
            <div class="installed-badge">{{ t $.Localizer "Installed" }}</div>
            {{ end }}

            <div class="app-img">
                <div class="skeleton-loader"></div>
                <img data-src="/preview/app/{{ .ID }}?file={{ .Preview }}" alt="{{ .Name }}" class="lazy-image">
            </div>

            <p>{{ .Name }} - {{ .Summary }}</p>
            <p>{{ t $.Localizer "From" }} {{ .Author }}</p>

            {{ if $.IsCustom }}
            <a href="/devices/{{ $.DeviceID }}/uploads/{{ .ID }}/delete" class="delete-upload-btn" onclick="event.stopPropagation(); return confirm('{{ t $.Localizer "Delete this uploaded app?" }}');">
                <i class="fa-solid fa-trash" aria-hidden="true"></i> {{ t $.Localizer "Delete" }}
            </a>
            {{ end }}
        </div>
        {{ end }}
    </div>
</div>
{{ end }}
