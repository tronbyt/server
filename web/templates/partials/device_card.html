{{ define "device_card" }}
<!-- Device Card Component -->
<div class="w3-card-4 w3-padding device-container">
  <article>
    <div>
      <table width="100%">
        <tr>
          <td colspan="2">
            <header>
              <h1>
                <a href="{{ .Item.Device.ImgURL }}" target="_blank" class="device-link">
                  {{ .Item.Device.Name }}
                </a>
                {{ if .Item.Device.PinnedApp }}
                    <span class="pinned-badge">
                      <i class="fa-solid fa-thumbtack" aria-hidden="true"></i> {{ t .Localizer "Pinned:" }} {{ deref .Item.Device.PinnedApp }}
                    </span>
                {{ end }}
              </h1>
            </header>
          </td>
          <td rowspan="4" width="40%">
            <div class="app-img"><img id="currentWebp-{{ .Item.Device.ID }}"
                data-src="/devices/{{ .Item.Device.ID }}/current"
                src="/devices/{{ .Item.Device.ID }}/current"
                alt="{{ t .Localizer "Preview" }}">
            </div>
            <div>{{ t .Localizer "Currently Displaying App" }}</div>
            <div class="device-info-box">
              <button class="device-info-toggle" aria-expanded="false" aria-controls="device-info-content-{{ .Item.Device.ID }}">
                <i class="fas fa-chevron-down"></i> {{ t .Localizer "Device Info" }}
              </button>
              <div id="device-info-content-{{ .Item.Device.ID }}" class="device-info-content">
                <table class="device-info-table">
                  {{ if .Item.Device.Info.FirmwareVersion }}
                  <tr><td>{{ t $.Localizer "Firmware Version:" }}</td><td>{{ .Item.Device.Info.FirmwareVersion }}</td></tr>
                  {{ end }}
                  {{ if .Item.Device.Info.FirmwareType }}
                  <tr><td>{{ t $.Localizer "Firmware Type:" }}</td><td>{{ .Item.Device.Info.FirmwareType }}</td></tr>
                  {{ end }}
                  {{ if .Item.Device.Info.ProtocolVersion }}
                  <tr><td>{{ t $.Localizer "Protocol Version:" }}</td><td>{{ deref .Item.Device.Info.ProtocolVersion }}</td></tr>
                  {{ end }}
                  {{ if .Item.Device.Info.MACAddress }}
                  <tr><td>{{ t $.Localizer "MAC Address:" }}</td><td>{{ .Item.Device.Info.MACAddress }}</td></tr>
                  {{ end }}
                  <tr><td>{{ t $.Localizer "Protocol Type:" }}</td><td>{{ .Item.Device.Info.ProtocolType }}</td></tr>
                  {{ if .Item.Device.LastSeen }}
                  <tr><td>{{ t $.Localizer "Last Seen:" }}</td><td>{{ timeago $.Localizer .Item.Device.LastSeen }}</td></tr>
                  {{ end }}
                </table>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <label>{{ t .Localizer "Brightness" }}</label> =
            <span id="brightnessValue-{{ .Item.Device.ID }}">{{ .Item.BrightnessUI }}</span>
            <div class="brightness-panel" id="brightness-panel-{{ .Item.Device.ID }}">
              {{ range $i := seq 0 5 }}
              <button type="button" class="brightness-btn {{ if eq $.Item.BrightnessUI $i }}active{{ end }}"
                      data-brightness="{{ $i }}" onclick="setBrightness('{{ $.Item.Device.ID }}', {{ $i }})">{{ $i }}</button>
              {{ end }}
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <label for="default_interval-{{ .Item.Device.ID }}">{{ t .Localizer "App Cycle Time (Seconds)" }}</label> = <span
              id="intervalValue-{{ .Item.Device.ID }}">{{
              .Item.Device.DefaultInterval }} </span> s<br>
            <input type="range" name="default_interval" id="default_interval-{{ .Item.Device.ID }}" min="1" max="30"
              value="{{ .Item.Device.DefaultInterval }}" oninput="updateIntervalValue('{{ .Item.Device.ID }}', this.value)"
              onmouseup="updateInterval('{{ .Item.Device.ID }}', this.value)">
          </td>
        </tr>
        <tr>
          <td>
            <a class="w3-button w3-teal w3-round" style="min-width: 100px;"
              href="/devices/{{ .Item.Device.ID }}/addapp"><i class="fa-solid fa-circle-plus" aria-hidden="true"></i> {{ t .Localizer "Add App" }}</a>

            <a class="w3-button w3-teal w3-round" style="min-width: 100px;"
              href="/devices/{{ .Item.Device.ID }}/update"><i class="fa-solid fa-pen-to-square" aria-hidden="true"></i> {{ t .Localizer "Edit Device" }}</a>
            {{ if .Item.Device.Type.SupportsFirmware }}
            <a class="w3-button w3-teal w3-round" style="min-width: 100px;"
               href="/devices/{{ .Item.Device.ID }}/firmware"><i class="fa-solid fa-microchip" aria-hidden="true"></i> {{ t .Localizer "Firmware" }}</a>
            {{ end }}
        </tr>
      </table>

      <!-- View Toggle Row -->
      <div class="view-toggle-row" style="display: flex; justify-content: space-between; align-items: center;">
        <div class="view-toggle-container" style="display: flex; align-items: center;">
          <span style="margin-right: 10px; font-weight: bold;">{{ t .Localizer "View:" }}</span>
          <button id="listViewBtn-{{ .Item.Device.ID }}" class="w3-button w3-blue w3-round view-toggle-btn active"
                  onclick="switchToListView('{{ .Item.Device.ID }}')" title="{{ t .Localizer "List View" }}">
            <i class="fas fa-list"></i> {{ t .Localizer "List" }}
          </button>
          <button id="gridViewBtn-{{ .Item.Device.ID }}" class="w3-button w3-blue w3-round view-toggle-btn"
                  onclick="switchToGridView('{{ .Item.Device.ID }}')" title="{{ t .Localizer "Grid View" }}">
            <i class="fas fa-th"></i> {{ t .Localizer "Grid" }}
          </button>
          <button id="collapsedViewBtn-{{ .Item.Device.ID }}" class="w3-button w3-blue w3-round view-toggle-btn"
                  onclick="switchToCollapsedView('{{ .Item.Device.ID }}')" title="{{ t .Localizer "Collapsed View" }}">
            <i class="fas fa-chevron-up"></i> {{ t .Localizer "Collapsed" }}
          </button>
        </div>
        <div class="instruction-text" style="color: #666; font-style: italic;">
          {{ t .Localizer "Drag apps to reorder or copy from/to another device" }}
        </div>
      </div>

      <div id="appsList-{{ .Item.Device.ID }}" class="visible apps-list-view">
        {{ range .Item.Device.Apps }}
          {{ template "app_card" (dict "App" . "Device" $.Item.Device "Localizer" $.Localizer "DevicesWithUIScales" $.DevicesWithUIScales) }}
          <hr class="list-view-separator">
        {{ end }}
      </div>

    </div>
  </article>
</div>
{{ end }}
