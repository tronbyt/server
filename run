#!/bin/bash
set -euo pipefail

# Run startup tasks that should only be executed once
python3 -c 'from tronbyt_server.startup import run_once; run_once()'

if [ "${PRODUCTION:-1}" = "1" ]; then
    # PRODUCTION
    exec uvicorn --host=0.0.0.0 --port=8000 --workers="${WEB_CONCURRENCY:-2}" tronbyt_server.main:app
else
    # DEVELOPMENT
    exec uvicorn --host=0.0.0.0 --port=8000 --reload tronbyt_server.main:app
fi
